<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Chun è²¡å‹™æ‰‹å¸³</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        :root {
            --bg: #fdfaf5;
            --primary: #8c7662;
            --text: #37352f;
            --sub: #9b9a97;
            --card-bg: #ffffff;
            --red: #eb5757;
            --green: #2d6a4f;
            --hl-saving: #d8e2dc;
            --hl-fixed: #f1d5d5;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; overflow-x: hidden; }

        /* é é¢åˆ‡æ›å‹•ç•« */
        .page { padding: 20px 24px 140px; max-width: 500px; margin: 0 auto; display: none; }
        .page.active { display: block; animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .brand { font-size: 28px; font-weight: 200; color: var(--primary); letter-spacing: 8px; text-align: center; margin: 40px 0 10px; }
        .quote { font-size: 11px; color: var(--sub); text-align: center; margin-bottom: 30px; font-style: italic; }

        /* å„€è¡¨æ¿æ¨£å¼ */
        .dashboard {
            background: var(--primary); color: white; padding: 30px 24px;
            border-bottom-left-radius: 30px; border-bottom-right-radius: 30px;
            margin-bottom: 25px; box-shadow: 0 10px 25px rgba(140,118,98,0.15);
        }
        .dash-main-val { font-size: 36px; font-weight: 200; text-align: center; margin: 10px 0 20px; }
        .dash-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; text-align: center; }
        .dash-label { font-size: 9px; opacity: 0.7; margin-bottom: 4px; }
        .dash-val { font-size: 12px; font-weight: 700; }

        .section-title { font-size: 11px; font-weight: 800; color: var(--sub); text-transform: uppercase; letter-spacing: 2.5px; margin: 30px 0 15px 5px; display: flex; justify-content: space-between; align-items: center; }
        
        .card { background: var(--card-bg); border-radius: 24px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(140,118,98,0.08); position: relative; }
        .clickable:active { transform: scale(0.97); opacity: 0.9; }
        
        /* æ¨™ç±¤æ¨£å¼ */
        .tag { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 10px; font-weight: 700; margin-right: 6px; }
        .tag-fixed { background: var(--hl-fixed); color: #a4161a; }
        .tag-saving { background: var(--hl-saving); color: #2d6a4f; }
        .tag-income { background: #e8f5e9; color: #2e7d32; }
        .tag-cate { background: #f0f0f0; color: #666; }
        
        .item-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #fcfaf5; }
        .item-row:last-child { border-bottom: none; }

        input, select { border: none; outline: none; background: #f5f2ed; padding: 12px; border-radius: 12px; width: 100%; font-size: 15px; margin-bottom: 12px; font-family: inherit; color: var(--text); }
        .btn-primary { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 15px; width: 100%; font-weight: 700; cursor: pointer; margin-top: 5px; }
        .btn-ghost { background: #eee; border: none; padding: 12px; border-radius: 15px; width: 100%; cursor: pointer; color: var(--sub); font-size: 13px; }

        /* å­åˆ†é¡ç®¡ç†æŒ‰éˆ•æ¨£å¼ */
        .cate-chip-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .cate-item { display: flex; align-items: center; background: white; border: 1px solid #eee; border-radius: 50px; overflow: hidden; }
        .cate-name { padding: 8px 12px 8px 16px; font-size: 13px; color: var(--text); cursor: pointer; }
        .cate-del-btn { padding: 8px 12px; color: var(--red); font-weight: bold; cursor: pointer; border-left: 1px solid #eee; font-size: 12px; }
        .cate-chip { padding: 8px 16px; background: #fff; border: 1px solid #eee; border-radius: 50px; font-size: 13px; cursor: pointer; }
        .cate-chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* å°è¦½åˆ— */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; height: 85px; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; padding-bottom: env(safe-area-inset-bottom); z-index: 100; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--sub); font-size: 10px; font-weight: 800; cursor: pointer; flex: 1; }
        .nav-item.active { color: var(--primary); }

        /* å½ˆçª— */
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px); z-index: 1000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-body { background: white; border-radius: 28px; width: 100%; max-width: 350px; padding: 25px; box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
    </style>
</head>
<body>

    <!-- é é¢ï¼šé¦–é  (å¹´åº¦èˆ‡åˆ†é¡) -->
    <div id="view-years" class="page active">
        <div class="brand">CHUN</div>
        <div class="quote">ã€Œç”Ÿæ´»çš„å¹³è¡¡ï¼Œå¾è²¡å‹™çš„ç´€éŒ„é–‹å§‹ã€‚ã€</div>
        
        <div class="section-title">å¹´åº¦å¸³æœ¬</div>
        <div id="year-container"></div>

        <div class="section-title">æ”¯å‡ºå­åˆ†é¡ç®¡ç† <span onclick="promptAddCategory()" style="color:var(--primary); font-size:10px; cursor:pointer; font-weight:bold;">[ + æ–°å¢åˆ†é¡ ]</span></div>
        <div class="card" style="padding:15px; background:rgba(140,118,98,0.03); border:none;">
            <div id="category-manager-list" class="cate-chip-group"></div>
        </div>

        <div class="section-title">æ¯æœˆå›ºå®šè¨ˆç•« <span onclick="openModal('fixed-modal')" style="color:var(--primary); font-size:10px; cursor:pointer; font-weight:bold;">[ + æ–°å¢é …ç›® ]</span></div>
        <div id="global-fixed-list"></div>
    </div>

    <!-- é é¢ï¼šæœˆä»½åˆ—è¡¨ -->
    <div id="view-months" class="page">
        <div onclick="showPage('view-years')" style="cursor:pointer; color:var(--sub); font-size:12px; font-weight:700; margin-bottom:15px;">â† è¿”å›é¦–é </div>
        <h2 id="month-year-title" style="font-size: 32px; font-weight: 200; margin: 0 0 20px;"></h2>
        <div id="month-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;"></div>
    </div>

    <!-- é é¢ï¼šæœˆä»½è©³ç´° -->
    <div id="view-detail" class="page" style="padding-top:0;">
        <div class="dashboard">
            <div onclick="showPage('view-months')" style="color:rgba(255,255,255,0.6); font-size:12px; cursor:pointer;">â† è¿”å›æœˆä»½</div>
            <div style="font-size:10px; text-align:center; opacity:0.8; margin-top:10px;">å‰©é¤˜å¯ç”¨ç”Ÿæ´»è²»</div>
            <div class="dash-main-val" id="dash-allowance">$ 0</div>
            <div class="dash-grid">
                <div><div class="dash-label">å­˜æ¬¾ç›®æ¨™</div><div class="dash-val" id="dash-saving">$ 0</div></div>
                <div><div class="dash-label">å›ºå®šé ç®—</div><div class="dash-val" id="dash-fixed">$ 0</div></div>
                <div><div class="dash-label">å·²æ”¯ç”Ÿæ´»è²»</div><div class="dash-val" id="dash-spent">$ 0</div></div>
            </div>
        </div>

        <h2 id="detail-month-label" style="font-size: 26px; font-weight: 200; margin-bottom:20px;"></h2>

        <div class="section-title">è–ªè³‡å¯¦é ˜è¨­å®š</div>
        <div class="card" style="padding:15px; display:flex; justify-content:space-between; align-items:center;">
            <div onclick="openModal('salary-modal')" class="clickable" style="display:flex; align-items:center; gap:12px;">
                <div style="background:#fdfaf5; width:40px; height:40px; border-radius:12px; display:flex; align-items:center; justify-content:center;">ğŸ’°</div>
                <div><span style="font-size:13px; font-weight:700; display:block;">è–ªè³‡è¨ˆç®—å™¨</span><span style="font-size:10px; color:var(--sub);">é»æ“Šè¨ˆç®—å¯¦é ˜é‡‘é¡</span></div>
            </div>
            <input type="number" id="month-income-input" style="text-align:right; font-weight:700; color:var(--primary); font-size:18px; width:120px; background:none; margin:0;" placeholder="0">
        </div>

        <div class="section-title">å¿«é€Ÿè¨˜å¸³</div>
        <div id="acc-quick-selector" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>

        <div class="section-title">å¸³æˆ¶æ”¶æ”¯æ˜ç´°</div>
        <div id="acc-detail-list"></div>
    </div>

    <!-- é é¢ï¼šè³‡ç”¢ç®¡ç† -->
    <div id="view-assets" class="page">
        <div class="brand" style="font-size:20px;">ASSETS</div>
        <div class="section-title">å¸³æˆ¶çµé¤˜ <span onclick="openModal('add-acc-modal')" style="color:var(--primary); font-size:10px; cursor:pointer; font-weight:bold;">[ + æ–°å¢å¸³æˆ¶ ]</span></div>
        <div id="asset-container"></div>
    </div>

    <!-- åº•éƒ¨å°è¦½ -->
    <nav class="nav">
        <div class="nav-item" id="nav-y" onclick="showPage('view-years')">ğŸ <br>é¦–é </div>
        <div class="nav-item" id="nav-a" onclick="showPage('view-assets')">ğŸ’³<br>è³‡ç”¢</div>
    </nav>

    <!-- å½ˆçª—ç¾¤ -->
    <div id="log-modal" class="modal">
        <div class="modal-body">
            <h3 id="log-modal-title" style="margin:0 0 15px 0;"></h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <button id="btn-type-out" class="btn-primary" style="margin:0; background:var(--red);" onclick="setLogType('æ”¯å‡º')">æ”¯å‡º</button>
                <button id="btn-type-in" class="btn-ghost" style="margin:0;" onclick="setLogType('æ”¶å…¥')">æ”¶å…¥</button>
            </div>
            <div id="log-cate-section">
                <div style="font-size:11px; color:var(--sub); margin-bottom:8px;">å­åˆ†é¡ï¼š</div>
                <div id="log-cate-selector" class="cate-chip-group" style="margin-bottom:15px;"></div>
            </div>
            <input type="number" id="l-amt" placeholder="è«‹è¼¸å…¥é‡‘é¡">
            <input type="text" id="l-note" placeholder="å‚™è¨» (é¸å¡«)">
            <button class="btn-primary" onclick="saveLog()">ç¢ºèªå„²å­˜</button>
            <button class="btn-ghost" style="margin-top:8px;" onclick="closeModal('log-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="fixed-modal" class="modal">
        <div class="modal-body">
            <h3 style="margin-bottom:20px;">æ–°å¢å›ºå®šè¨ˆç•«</h3>
            <input type="text" id="f-name" placeholder="é …ç›®åç¨± (å¦‚ï¼šæˆ¿ç§Ÿã€å„²è“„)">
            <input type="number" id="f-amt" placeholder="æ¯æœˆå›ºå®šé‡‘é¡">
            <select id="f-type">
                <option value="å›ºå®š">æ¯æœˆå›ºå®šæ”¯å‡º (å¦‚æˆ¿ç§Ÿã€è»Šè²¸)</option>
                <option value="å­˜æ¬¾">æ¯æœˆå­˜æ¬¾ç›®æ¨™ (å¦‚å®šå­˜ã€åŸºé‡‘)</option>
            </select>
            <select id="f-acc" class="acc-dropdown-inject"></select>
            <button class="btn-primary" onclick="saveFixed()">åŠ å…¥è¨ˆç•«</button>
            <button class="btn-ghost" style="margin-top:8px;" onclick="closeModal('fixed-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="salary-modal" class="modal">
        <div class="modal-body">
            <h3>è–ªè³‡çµç®—å™¨</h3>
            <input type="number" id="s-base" placeholder="æœ¬è–ª (+)">
            <input type="number" id="s-ins" placeholder="å¥ä¿/å‹é€€ (-)">
            <input type="number" id="s-off" placeholder="æ‰£æ¬¾/è«‹å‡ (-)">
            <div id="s-res" style="background:#fdfaf5; padding:15px; border-radius:15px; text-align:center; margin-bottom:15px; font-weight:700; color:var(--primary); font-size:20px;">$ 0</div>
            <button class="btn-primary" onclick="applySalary()">å¸¶å…¥æœ¬æœˆå¯¦é ˜</button>
            <button class="btn-ghost" style="margin-top:8px;" onclick="closeModal('salary-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <div id="add-acc-modal" class="modal">
        <div class="modal-body">
            <h3>æ–°å¢è³‡ç”¢å¸³æˆ¶</h3>
            <input type="text" id="new-acc-name" placeholder="å¸³æˆ¶åç¨± (å¦‚ï¼šä¸­ä¿¡ã€ç¾é‡‘)">
            <input type="number" id="new-acc-bal" placeholder="ç•¶å‰é¤˜é¡">
            <button class="btn-primary" onclick="saveNewAccount()">æ–°å¢</button>
            <button class="btn-ghost" style="margin-top:8px;" onclick="closeModal('add-acc-modal')">å–æ¶ˆ</button>
        </div>
    </div>

    <script>
        const DB_KEY = 'chun_finance_final_stable_v1';
        let state = JSON.parse(localStorage.getItem(DB_KEY)) || {
            years: ["2025", "2024"],
            accounts: ["ä¸­åœ‹ä¿¡è¨—", "åœ‹æ³°ä¸–è¯", "éƒµå±€"],
            categories: ["åˆé¤", "æ™šé¤", "äº¤é€š", "è³¼ç‰©", "å¨›æ¨‚"],
            balances: { "ä¸­åœ‹ä¿¡è¨—": 0, "åœ‹æ³°ä¸–è¯": 0, "éƒµå±€": 0 },
            globalFixed: [],
            monthlyData: {}
        };

        let curYear = "2025";
        let curMonth = "ä¸€æœˆ";
        let curLogType = "æ”¯å‡º";
        let activeAcc = "";
        let activeCate = "åˆé¤";

        window.onload = () => {
            // ç›£è½è–ªè³‡è¨ˆç®—å™¨
            ['s-base', 's-ins', 's-off'].forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.addEventListener('input', () => {
                        const b = parseFloat(document.getElementById('s-base').value) || 0;
                        const i = parseFloat(document.getElementById('s-ins').value) || 0;
                        const o = parseFloat(document.getElementById('s-off').value) || 0;
                        document.getElementById('s-res').innerText = `$ ${(b-i-o).toLocaleString()}`;
                    });
                }
            });

            // ç›£è½è–ªè³‡æ¬„ä½æ‰‹å‹•ä¿®æ”¹
            document.getElementById('month-income-input').addEventListener('input', (e) => {
                const key = `${curYear}-${curMonth}`;
                if(!state.monthlyData[key]) state.monthlyData[key] = { income: 0, logs: [] };
                state.monthlyData[key].income = parseFloat(e.target.value) || 0;
                localStorage.setItem(DB_KEY, JSON.stringify(state));
                updateDashboard();
            });

            render();
        };

        function save() {
            localStorage.setItem(DB_KEY, JSON.stringify(state));
            render();
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(id === 'view-years' || id === 'view-months') document.getElementById('nav-y').classList.add('active');
            if(id === 'view-assets') document.getElementById('nav-a').classList.add('active');
            render();
        }

        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        /* --- åˆ†é¡ç®¡ç†é‚è¼¯ --- */
        function promptAddCategory() {
            const name = prompt("è«‹è¼¸å…¥æ–°åˆ†é¡åç¨±ï¼š");
            if (name && name.trim()) {
                if (!state.categories.includes(name.trim())) {
                    state.categories.push(name.trim());
                    save();
                }
            }
        }

        function editCategory(oldName) {
            const newName = prompt("ä¿®æ”¹åˆ†é¡åç¨±ï¼š", oldName);
            if (newName && newName.trim() && newName !== oldName) {
                const idx = state.categories.indexOf(oldName);
                if (idx > -1) {
                    state.categories[idx] = newName.trim();
                    save();
                }
            }
        }

        function deleteCategory(name) {
            if (confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${name}ã€åˆ†é¡å—ï¼Ÿ`)) {
                state.categories = state.categories.filter(c => c !== name);
                save();
            }
        }

        /* --- è¨˜å¸³é‚è¼¯ --- */
        function setLogType(type) {
            curLogType = type;
            const btnOut = document.getElementById('btn-type-out');
            const btnIn = document.getElementById('btn-type-in');
            if (type === 'æ”¯å‡º') {
                btnOut.className = 'btn-primary'; btnOut.style.background = 'var(--red)';
                btnIn.className = 'btn-ghost';
                document.getElementById('log-cate-section').style.display = 'block';
            } else {
                btnIn.className = 'btn-primary'; btnIn.style.background = 'var(--green)';
                btnOut.className = 'btn-ghost';
                document.getElementById('log-cate-section').style.display = 'none';
            }
            renderLogCates();
        }

        function renderLogCates() {
            const container = document.getElementById('log-cate-selector');
            container.innerHTML = state.categories.map(c => `
                <div class="cate-chip ${activeCate === c ? 'active' : ''}" onclick="activeCate='${c}'; renderLogCates();">${c}</div>
            `).join('');
        }

        function openLogFor(acc) {
            activeAcc = acc;
            activeCate = state.categories[0] || "";
            document.getElementById('log-modal-title').innerText = `${acc} è¨˜å¸³`;
            setLogType('æ”¯å‡º');
            openModal('log-modal');
        }

        function saveLog() {
            const amt = parseFloat(document.getElementById('l-amt').value);
            const note = document.getElementById('l-note').value;
            if(isNaN(amt)) return;

            const key = `${curYear}-${curMonth}`;
            if(!state.monthlyData[key]) state.monthlyData[key] = { income: 0, logs: [] };

            state.monthlyData[key].logs.push({
                acc: activeAcc,
                type: curLogType,
                amt: amt,
                cate: curLogType === 'æ”¯å‡º' ? activeCate : 'å­˜å…¥',
                note: note || (curLogType === 'æ”¯å‡º' ? activeCate : 'è–ªè³‡å­˜å…¥')
            });

            state.balances[activeAcc] += (curLogType === 'æ”¯å‡º' ? -amt : amt);
            document.getElementById('l-amt').value = "";
            document.getElementById('l-note').value = "";
            closeModal('log-modal');
            save();
        }

        function saveFixed() {
            const n = document.getElementById('f-name').value;
            const a = parseFloat(document.getElementById('f-amt').value);
            const acc = document.getElementById('f-acc').value;
            const type = document.getElementById('f-type').value;
            if(!n || isNaN(a)) return;
            state.globalFixed.push({ name: n, amt: a, type: type, acc: acc });
            closeModal('fixed-modal');
            save();
        }

        function saveNewAccount() {
            const n = document.getElementById('new-acc-name').value;
            const b = parseFloat(document.getElementById('new-acc-bal').value) || 0;
            if(!n) return;
            if(!state.accounts.includes(n)) state.accounts.push(n);
            state.balances[n] = b;
            closeModal('add-acc-modal');
            save();
        }

        function applySalary() {
            const b = parseFloat(document.getElementById('s-base').value) || 0;
            const i = parseFloat(document.getElementById('s-ins').value) || 0;
            const o = parseFloat(document.getElementById('s-off').value) || 0;
            const res = b - i - o;
            const key = `${curYear}-${curMonth}`;
            if(!state.monthlyData[key]) state.monthlyData[key] = { income: 0, logs: [] };
            state.monthlyData[key].income = res;
            closeModal('salary-modal');
            save();
        }

        function updateDashboard() {
            const mk = `${curYear}-${curMonth}`;
            const md = state.monthlyData[mk] || { income: 0, logs: [] };
            const savingT = state.globalFixed.filter(f => f.type === 'å­˜æ¬¾').reduce((s,f)=>s+f.amt,0);
            const fixedT = state.globalFixed.filter(f => f.type !== 'å­˜æ¬¾').reduce((s,f)=>s+f.amt,0);
            const spentT = md.logs.filter(l => l.type === 'æ”¯å‡º').reduce((s,l)=>s+l.amt, 0);
            const allowance = (md.income || 0) - savingT - fixedT - spentT;

            document.getElementById('dash-allowance').innerText = `$ ${allowance.toLocaleString()}`;
            document.getElementById('dash-saving').innerText = `$ ${savingT.toLocaleString()}`;
            document.getElementById('dash-fixed').innerText = `$ ${fixedT.toLocaleString()}`;
            document.getElementById('dash-spent').innerText = `$ ${spentT.toLocaleString()}`;
        }

        function render() {
            // å¹´åº¦
            document.getElementById('year-container').innerHTML = state.years.map(y => `
                <div class="card clickable" style="padding:15px;" onclick="curYear='${y}'; showPage('view-months')">
                    <div style="font-size:9px; color:var(--sub); font-weight:800;">ANNUAL</div>
                    <div style="font-size:22px; font-weight:300; margin-top:5px;">${y} å¹´åº¦å¸³æœ¬</div>
                </div>
            `).join('');

            // å­åˆ†é¡ç®¡ç†
            document.getElementById('category-manager-list').innerHTML = state.categories.map(c => `
                <div class="cate-item">
                    <div class="cate-name" onclick="editCategory('${c}')">${c}</div>
                    <div class="cate-del-btn" onclick="deleteCategory('${c}')">âœ•</div>
                </div>
            `).join('');

            // å›ºå®šè¨ˆç•«
            document.getElementById('global-fixed-list').innerHTML = state.globalFixed.map((f, i) => `
                <div class="card" style="padding:15px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span class="tag ${f.type==='å­˜æ¬¾'?'tag-saving':'tag-fixed'}">${f.type}</span>
                        <b style="font-size:14px;">${f.name}</b>
                        <div style="font-size:10px; color:var(--sub); margin-top:2px;">æ‰£æ¬¾ï¼š${f.acc}</div>
                    </div>
                    <div style="text-align:right">
                        <div style="font-weight:700; color:var(--red)">-$${f.amt.toLocaleString()}</div>
                        <div onclick="state.globalFixed.splice(${i},1); save();" style="font-size:9px; color:#ccc; cursor:pointer; margin-top:5px;">ç§»é™¤</div>
                    </div>
                </div>
            `).join('') || '<div style="text-align:center; color:#ccc; font-size:12px; padding:20px;">å°šç„¡å›ºå®šé …ç›®</div>';

            // æœˆä»½
            document.getElementById('month-year-title').innerText = curYear;
            const ms = ["ä¸€æœˆ","äºŒæœˆ","ä¸‰æœˆ","å››æœˆ","äº”æœˆ","å…­æœˆ","ä¸ƒæœˆ","å…«æœˆ","ä¹æœˆ","åæœˆ","åä¸€æœˆ","åäºŒæœˆ"];
            document.getElementById('month-grid').innerHTML = ms.map(m => `
                <div class="card clickable" style="padding:15px; text-align:center; margin:0; border-radius:18px;" onclick="curMonth='${m}'; showPage('view-detail')">${m}</div>
            `).join('');

            // è©³ç´°å…§å®¹
            const mk = `${curYear}-${curMonth}`;
            const md = state.monthlyData[mk] || { income: 0, logs: [] };
            document.getElementById('detail-month-label').innerText = `${curYear} ${curMonth}`;
            document.getElementById('month-income-input').value = md.income || "";
            updateDashboard();

            // è¨˜å¸³æŒ‰éˆ•
            document.getElementById('acc-quick-selector').innerHTML = state.accounts.map(acc => `
                <div class="card clickable" style="padding:15px; margin:0; text-align:center;" onclick="openLogFor('${acc}')">
                    <div style="font-size:11px; color:var(--sub); font-weight:700;">${acc}</div>
                    <div style="font-size:13px; color:var(--primary); font-weight:500; margin-top:4px;">+ è¨˜å¸³</div>
                </div>
            `).join('');

            // æ˜ç´°
            document.getElementById('acc-detail-list').innerHTML = state.accounts.map(acc => {
                const logs = md.logs.filter(l => l.acc === acc);
                const fixed = state.globalFixed.filter(f => f.acc === acc);
                if(logs.length === 0 && fixed.length === 0) return '';
                
                return `
                    <div class="card" style="padding:15px;">
                        <div style="font-size:11px; font-weight:800; color:var(--primary); margin-bottom:10px; border-bottom:1px solid #fcfaf5; padding-bottom:5px;">${acc} æ˜ç´°</div>
                        ${fixed.map(f => `<div class="item-row"><span><span class="tag tag-fixed">${f.type}</span>${f.name}</span><span style="color:var(--red)">-$${f.amt.toLocaleString()}</span></div>`).join('')}
                        ${logs.map((l) => `
                            <div class="item-row">
                                <span><span class="tag ${l.type==='æ”¶å…¥'?'tag-income':'tag-cate'}">${l.cate}</span>${l.note}</span>
                                <span style="color:${l.type==='æ”¶å…¥'? 'var(--green)':'var(--text)'}">${l.type==='æ”¶å…¥'?'+':'-'}$${l.amt.toLocaleString()}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('') || '<div style="text-align:center; color:#ccc; padding:40px; font-size:12px;">æœ¬æœˆç„¡ä»»ä½•ç´€éŒ„</div>';

            // è³‡ç”¢
            document.getElementById('asset-container').innerHTML = state.accounts.map(a => `
                <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                    <div><div style="font-size:10px; color:var(--sub);">${a}</div><div style="font-size:24px; font-weight:700; color:var(--primary);">$ ${state.balances[a].toLocaleString()}</div></div>
                    <div onclick="if(confirm('åˆªé™¤å¸³æˆ¶ï¼Ÿ')){state.accounts=state.accounts.filter(x=>x!=='${a}'); save();}" style="font-size:9px; color:#ddd; cursor:pointer;">åˆªé™¤</div>
                </div>
            `).join('');

            // æ›´æ–°ä¸‹æ‹‰é¸å–®
            document.querySelectorAll('.acc-dropdown-inject').forEach(el => {
                el.innerHTML = state.accounts.map(a => `<option value="${a}">${a}</option>`).join('');
            });
        }
    </script>
</body>
</html>

